# server.log grok监控

global:
  config_version: 2
input:
  type: file
  path: {{ path }}/log/grok.log
grok:
  patterns_dir: {{ exporter_path }}/grok-patterns
metrics:
  - type: counter
    name: log_level_total
    help: log total of each level
    match: '^%{LOGLEVEL:level}: '
    labels:
      level: '{{"{{.level}}"}}'
  - type: histogram
    name: request_time_cost
    help: request time cost of service requests
    match: '%{DATE} %{TIME}: %{TEXT} %{TEXT} \* %{TEXT} %{COUNTER}%{TEXT_OR_SEP}api=%{TEXT:api}%{TEXT_OR_SEP}tm=%{TEXT:tm}%{TEXT_OR_SEP}source=%{TEXT:sr}%{TEXT_OR_SEP}rt=%{TEXT:rtn} '
    value: '{{"{{.tm}}"}}'
    buckets: [100000,200000,300000,400000,500000,600000,700000,800000,900000,1000000,2000000,3000000,4000000,5000000,6000000,7000000,8000000,9000000,10000000]
    labels:
      api: '{{"{{.api}}"}}'
      source: '{{"{{.sr}}"}}'
      rtn: '{{"{{.rtn}}"}}'
server:
  port: 39101
